# 402pay Platform Environment Variables
# Copy this file to .env and configure with your actual values
# NEVER commit .env to version control!

# ============================================================================
# Server Configuration
# ============================================================================
PORT=3001
NODE_ENV=development  # development | production | test

# ============================================================================
# Database Configuration (REQUIRED)
# ============================================================================
# PostgreSQL connection string - REQUIRED for production
# Format: postgresql://USERNAME:PASSWORD@HOST:PORT/DATABASE
DATABASE_URL="postgresql://402pay:402pay@localhost:5432/402pay"

# Example production (use secrets manager):
# DATABASE_URL="postgresql://user:password@db.example.com:5432/402pay_prod"

# ============================================================================
# Solana Configuration
# ============================================================================
# Solana network: mainnet-beta, devnet, testnet
SOLANA_NETWORK=devnet

# Solana RPC endpoint
SOLANA_RPC_URL=https://api.devnet.solana.com

# For production (use paid RPC for reliability):
# SOLANA_RPC_URL=https://mainnet.helius-rpc.com/?api-key=YOUR_KEY
# SOLANA_RPC_URL=https://rpc.ankr.com/solana

# Payment recipient address (your wallet)
PAYMENT_RECIPIENT_ADDRESS=your-solana-wallet-address-here

# ============================================================================
# Kora RPC Configuration (for gasless transactions)
# ============================================================================
# Kora RPC server URL
KORA_RPC_URL=http://localhost:8080

# Kora API key (optional, recommended for production)
# This should match the api_key in kora-config/kora.toml [auth] section
KORA_API_KEY=kora_facilitator_api_key_example

# Enable mainnet support for Kora facilitator
KORA_MAINNET_ENABLED=false

# ============================================================================
# CORS Configuration (REQUIRED for production)
# ============================================================================
# Comma-separated list of allowed origins (NO wildcards!)
# IMPORTANT: Must be set in production or requests will be blocked
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001

# Production example:
# ALLOWED_ORIGINS=https://dashboard.example.com,https://app.example.com,https://api.example.com

# Security notes:
# - NEVER use "*" wildcard in production
# - Include protocol (https://)
# - No trailing slashes
# - Separate multiple origins with commas only (no spaces)

# ============================================================================
# Redis Configuration
# ============================================================================
REDIS_URL=redis://localhost:6379

# ============================================================================
# JWT Configuration
# ============================================================================
JWT_SECRET=your-super-secret-jwt-key-change-in-production

# ============================================================================
# Rate Limiting
# ============================================================================
# Requests per minute for public endpoints
PUBLIC_RATE_LIMIT=100

# Requests per minute for authenticated endpoints
AUTH_RATE_LIMIT=200

# Requests per minute for verification endpoints
VERIFY_RATE_LIMIT=50

# ============================================================================
# x402 Protocol Configuration
# ============================================================================
# Default payment timeout in seconds
X402_DEFAULT_TIMEOUT=60

# Maximum payment amount (in lamports)
X402_MAX_AMOUNT=1000000000

# Minimum payment amount (in lamports)
X402_MIN_AMOUNT=1000

# ============================================================================
# Monitoring & Observability
# ============================================================================
# Enable Prometheus metrics
ENABLE_METRICS=true

# Log level: error, warn, info, debug, trace
LOG_LEVEL=info

# ============================================================================
# Database Configuration (if using PostgreSQL)
# ============================================================================
# DATABASE_URL=postgresql://user:password@localhost:5432/402pay

# ============================================================================
# Production Security Checklist
# ============================================================================
# Before deploying to production, ensure:
#
# ✅ DATABASE_URL is set and secured (use connection pooling)
# ✅ ALLOWED_ORIGINS is configured (NOT using defaults)
# ✅ NODE_ENV=production is set
# ✅ JWT_SECRET is cryptographically random (use: openssl rand -hex 32)
# ✅ Redis is configured with authentication
# ✅ Database credentials use least privilege
# ✅ Solana RPC uses paid/reliable endpoint (not public devnet)
# ✅ API keys are generated via /api-keys endpoint (not demo-key)
# ✅ Logs are configured for production monitoring
# ✅ Rate limits are tuned for expected load
#
# See SECURITY_FIXES.md for detailed security guidance

# ============================================================================
# Migration & Deployment Notes
# ============================================================================
# 1. Copy this file to .env and fill in your values
# 2. NEVER commit .env to version control
# 3. For production, use secrets manager (AWS Secrets Manager, HashiCorp Vault)
# 4. Run database migrations: pnpm --filter @402pay/facilitator prisma migrate deploy
# 5. Seed marketplace data: POST /marketplace/seed (with valid API key)
# 6. See kora-config/README.md for Kora setup instructions
# 7. Monitor /health and /metrics endpoints for service health
